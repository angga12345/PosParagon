<?xml version="1.0" encoding="utf-8"?>
<!--
 Copyright (C) 2016 by PT Paragon Technology And Innovation

 This file is part of PTI Odoo Addons.

 PTI Odoo Addons is free software: you can redistribute it and/or modify
 it under the terms of the GNU Lesser General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 PTI Odoo Addons is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public License
 along with PTI Odoo Addons.  If not, see <http://www.gnu.org/licenses/>.
-->
<openerp>
	<data>
        <record id="view_move_line_collector_tree" model="ir.ui.view">
            <field name="name">account.move.line.collector.tree</field>
            <field name="model">account.move.line</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Money Collector" create="false">
                    <field name="date" readonly="1"/>
                    <field name="move_id" readonly="1" options='{"no_open":True}' invisible="1"/>
                    <field name="journal_id" options='{"no_open":True}' readonly="1" invisible="1"/>
                    <field name="name"  readonly="1" invisible="1"/>
                    <field name="ref"  readonly="1" invisible="1"/>
                    <field name="statement_id" invisible="1"/>
                    <field name="partner_id"  readonly="1"/>
                    <field name="account_id" options='{"no_open":True}' domain="[('company_id', '=', company_id)]" invisible="1"/>
                    <field name="analytic_account_id" groups="analytic.group_analytic_accounting"/>
                    <field name="reconciled" invisible="1"/>
                    <field name="debit" sum="Total Debit" readonly="1"/>
                    <field name="credit" sum="Total Credit" readonly="1"/>
                    <field name="date_maturity" invisible="1"/>
                    <field name="amount_currency" readonly="True" invisible="not context.get('currency',False)"/>
                    <field name="currency_id" readonly="True" invisible="not context.get('currency',False)" />
                    <field name="company_currency_id" invisible="1"/>
                    <field name="company_id" invisible="1"/>
                    <field name="collector_invoice_id"  context="{'form_view_ref': 'account.invoice_form'}"/>
                    <field name="collector_id"  context="{'form_view_ref': 'base.view_partner_form'}" 
                        attrs="{'readonly' : [('collector_validated', '=', True)] }"
                        options="{'no_create': True}"/>
                    <field name="collector_validated" invisible="1"/>
                    <button
					   id="assign_collector"
					   name="%(pti_money_collector.action_assign_collector)d"
				       type="action"
				       string="Assign"
				       help="Assign collector"
                       attrs="{'invisible' : [('collector_validated', '=', True)]}"
                    />
                    <field name="dc_collector_id" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="view_account_move_line_collector_filter" model="ir.ui.view">
            <field name="name">Money Collector</field>
            <field name="model">account.move.line</field>
            <field eval="100" name="priority"/>
            <field name="arch" type="xml">
                <search string="Search Journal Items">
                    <field name="name" filter_domain="['|', ('name','ilike',self), ('ref','ilike',self)]" string="Move"/>
                    <field name="date"/>
                    <field name="tax_line_id"/>
                    <field name="tax_ids" />
                    <separator/>
                    <filter string="Unposted" domain="[('move_id.state','=','draft')]" help="Unposted Journal Items"/>
                    <filter name="posted" string="Posted" domain="[('move_id.state','=','posted')]" help="Posted Journal Items"/>
                    <separator/>
                    <filter string="Unreconciled" domain="[('reconciled','=',False), ('account_id.reconcile','=',True)]" help="Unreconciled Journal Items" name="unreconciled"/>
                    <separator/>
                    <filter string="Sales" domain="[('journal_id.type','=','sale')]" name="sale_journal" context="{'default_journal_type': 'sale'}"/>
                    <filter string="Purchases" domain="[('journal_id.type','=','purchase')]" context="{'default_journal_type': 'purchase'}"/>
                    <filter string="Bank Operations" name="bank_journal" domain="[('journal_id.type','=','bank')]" context="{'default_journal_type': 'bank'}"/>
                    <filter string="Cash Operations" name="cash_journal" domain="[('journal_id.type','=','cash')]" context="{'default_journal_type': 'cash'}"/>
                    <filter string="Miscellaneous Operations" domain="[('journal_id.type','=','general')]" name="misc_filter" context="{'default_journal_type': 'general'}"/>
                    <separator/>
                    <filter string="No Collector" name="no_collector" domain="[('collector_id','=',False)]"/>
                    <separator/>
                    <filter string="Not Validated" name="not_validated" domain="[('collector_validated','=',False)]"/>
                    <separator/>
                    <filter string="Last 2 Month" name="last2month" 
                        domain="[('date','&lt;=', time.strftime('%Y-%m-%d')), ('date','&gt;=',(context_today() + relativedelta(months= -1 )).strftime('%Y-%m-1'))]" help="month"/> 
                    <separator/>
                    <field name="collector_id"/>
                    <field name="move_id" string="Number (Move)"/>
                    <field name="account_id"/>
                    <field name="partner_id"/>
                    <field name="journal_id"/> 
                    <group expand="0" string="Group By">
                        <filter string="Collector" domain="[]" context="{'group_by':'collector_id'}"/>
                        <filter string="DC Collector" domain="[]" context="{'group_by':'dc_collector_id'}"/>
                        <filter string="Partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Journal" domain="[]" context="{'group_by':'journal_id'}"/>
                        <filter string="Account"  context="{'group_by':'account_id'}"/>
                        <filter string="Date" domain="[]" context="{'group_by':'date'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_move_line_collector" model="ir.actions.act_window">
            <field name="name">Money Collector</field>
            <field name="res_model">account.move.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_move_line_collector_tree"/>
            <field name="search_view_id" ref="view_account_move_line_collector_filter"/>
            <field name="domain">[('move_id.state','=','posted'),('collector_invoice_id','!=',False)]</field>
            <!--field name="domain">[('reconciled','=',False)]</field-->
            <field name="context">{
                'search_default_bank_journal': True, 
                'search_default_cash_journal': True, 
                'search_default_last2month': True, 
                'search_default_no_collector': True, 
                'search_default_not_validated': True}</field>
        </record>

         <menuitem
            icon="STOCK_JUSTIFY_FILL"
            action="action_move_line_collector"
            id="menu_action_move_line_collector"
            parent="base.menu_sales"
            groups="pti_branch.group_pti_branch_customer_order,base.group_system"
            sequence="21"/>

	</data>
</openerp>
